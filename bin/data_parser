#!/usr/bin/env ruby

$LOAD_PATH.unshift(File.join(File.dirname(__FILE__),'..','lib'))

require "bundler/setup"
require "senat_data"

SenatData.base_path=File.join(File.dirname(__FILE__),'..','..',"data","source")

senators = SenatData::Parser::List.parse
senators2 = SenatData::Parser::Detail.parse

senators2.each{|i,s| s.keys.each{|k| senators[i][k]=s[k] }}

SenatData::Store.store(File.join(SenatData.base_path,"../export/senators.json"), senators)

votes = SenatData::Parser::RSS.parse

SenatData::Store.store(File.join(SenatData.base_path,"../export/votes.json"),
  SenatData::Reducer::Votes.reduce(votes), false
)
